{"remainingRequest":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zuber/Desktop/document/company/mobile_ts/src/components/common/scroll.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/zuber/Desktop/document/company/mobile_ts/src/components/common/scroll.vue","mtime":1541121876622},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/postcss-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/less-loader/dist/cjs.js","mtime":1540785621795},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/cache-loader/dist/cjs.js","mtime":1540785597449},{"path":"/Users/zuber/Desktop/document/company/mobile_ts/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.allow{\n  overflow:hidden;\n  height: auto;\n}\n.prohibit{\n  max-width: 100%;\n  max-height: 100%;\n  height: 100%;\n  overflow:hidden;\n  overflow-y: scroll;\n  -webkit-overflow-scrolling: touch;\n  will-change: transform;\n  transition: all 450ms;\n  backface-visibility: hidden;\n  perspective: 1000;\n}\n.my-scroll{\n  position: relative;\n  color: #333333;\n  font-size: 14px;\n  .scroll-top{\n    text-align: center;\n    display:flex;\n    position:absolute;\n    top:0;\n    left:0;\n    width:100%;\n    overflow: hidden;\n    div{\n      display:flex;\n      height:auto;\n      width:100%;\n      justify-content: center;\n      align-items:center;\n      flex-wrap: wrap;\n      i{\n        flex:1 0 100%;\n        display:block;\n        height: 0.4rem;\n      }\n      img{\n        width:0.6rem;\n      }\n      p{\n        flex:1 0 100%;\n      }\n    }\n  }\n  .scroll-list{\n    overflow:hidden;\n    min-height: 100%;\n  }\n  .scroll-bottom{\n    text-align: center;\n    line-height: 40px;\n  }\n}\n",{"version":3,"sources":["scroll.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scroll.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n  <div class=\"my-scroll\" :class=\"[scrollState?'prohibit':'allow']\" ref=\"myScroll\" @scroll.passive=\"onScroll($event)\" @touchstart=\"touchStart($event)\" @touchmove=\"touchMove($event)\" @touchend=\"touchEnd($event)\"  >\n    <div class=\"scroll-top\" :style=\"{height:top+'px'}\">\n      <div v-if=\"aspect==2\">\n        <p v-if=\"state==6\">\n          下拉刷新\n        </p>\n        <p v-if=\"state==1\">\n          <!-- <i><img :src=\"Load\"/></i> -->\n          <br/>\n          刷新中\n        </p>\n        <p v-if=\"state==2\">松开刷新</p>\n        <p v-if=\"state==3\">\n          <!-- <i><img :src=\"Load\"/></i> -->\n          <br/>\n          刷新完成\n        </p>\n      </div>\n    </div>\n    <div class=\"scroll-list\" :style=\"{ transform: 'translate3d(0, ' + top + 'px, 0)'}\">\n      <slot name='scrollList'></slot>\n      <div class=\"scroll-bottom\">\n        <div v-if=\"state==4\">加载中</div>\n        <div v-if=\"state==5\">加载完成</div>\n        <div v-if=\"state==7\">没有更多</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue, Prop } from 'vue-property-decorator';\nimport { State, Action } from 'vuex-class';\nimport tween from '@/utils/tween';\n\n@Component\nexport default class Scroll extends Vue {\n  private Load: any;\n  private pageX: number = 0;\n  private pageY: number = 0;\n  private state: number = 0;\n  private scrollPosition: number = 0;\n  private myScroll: any = null;\n  private myScrollList: any = null;\n  private top: number = 0;\n  private aspect: number = 0; // 1 上下  2 左右\n  private listHeight: number = 0;\n  // @Prop({default: {}}) private page!: any;\n  @Prop({default: {}}) private onRefresh!: any;\n  @Prop({default: {}}) private onPull!: any;\n  @Prop({default: {}}) private getScrollTop!: any;\n  // @Prop({default: {}}) private setScrollPage!: any;\n  @Prop({default: true}) private scrollState?: boolean;\n  private scrollTop(top: number): void {\n    this.myScroll.scrollTop = top;\n  }\n  // 刷新中： 1\n  // 松开刷新： 2\n  // 刷新完成： 3\n  // 加载中： 4\n  // 加载完成： 5\n  // 下拉刷新： 6\n  // 没有更多： 7\n  private setState(index: number) {\n    this.state = index;\n    if (index === 5 || index === 3) {\n      setTimeout(() => {\n        this.state = 0;\n        let timer: any = null;\n        const that = this;\n        const b = 50;\n        const c = 100;\n        const d = 100;\n        const t = 0;\n        cancelAnimationFrame(timer);\n        timer = requestAnimationFrame(function fn() {\n          const oTop: number = that.top;\n          if (that.top > 0) {\n            that.top = Math.ceil(tween.Quart.easeInOut(10, oTop, 8, 10)) - 15;\n            timer = requestAnimationFrame(fn);\n          } else {\n            cancelAnimationFrame(timer);\n            that.top = 0;\n          }\n        });\n      }, 500);\n    }\n  }\n  // 触摸事件\n  private touchStart(e: any): void {\n    this.pageX = e.targetTouches[0].pageX;\n    this.pageY = e.targetTouches[0].pageY;\n  }\n  // 触摸滑动事件\n  private touchMove(e: any): void {\n    this.scrollPosition = this.myScroll.scrollTop; // 获取滚动条位置\n    if (this.scrollState && (e.targetTouches[0].pageY > this.pageY)) { // 向上滑动\n      this.aspect = 2;\n      if (this.myScroll.scrollTop === 0) {\n        const diff = e.targetTouches[0].pageY - this.pageY - this.scrollPosition;\n        this.top = Math.pow(diff, 0.9);\n        const ranget = diff / document.body.clientHeight * 100; // 计算在屏幕上滑动了多少\n        if (ranget > 20) {\n          this.state = 2;\n        } else if (ranget < 15) {\n          this.state = 6;\n        }\n        e.preventDefault();\n      }\n    } else if (this.scrollState && this.state !== 4) { // 向下滑动\n      this.aspect = 1;\n    }\n  }\n  private touchEnd(e: any): void {\n    if (this.aspect === 2 && this.state === 2 || this.state === 1) { // 上拉处理\n      this.top = 100;\n      this.state = 1;\n      this.topCallback();\n    } else if (this.aspect === 2) {\n      this.state = 0;\n      this.top = 0;\n    }\n  }\n  private onScroll(e: any): void {\n    const listHeight = this.myScrollList.offsetHeight; // 列表总高度\n    const listScrollTop = e.target.scrollTop + this.myScroll.offsetHeight; // 当前滚动\n    if (this.state === 0 && listHeight - listScrollTop < 100) {\n      this.bottomCallback();\n    }\n    if (this.getScrollTop) {\n      this.getScrollTop(e.target.scrollTop); // 返回x, y\n    }\n  }\n  private topCallback(): void {\n    this.onRefresh(this.state);\n  }\n  private bottomCallback(): void {\n    if (this.state !== 7) {\n      this.state = 4;\n      this.onPull(this.state);\n    }\n  }\n  private mounted(): void {\n    this.myScroll = this.$refs.myScroll; // 获取滑条dom\n    this.myScrollList = this.myScroll.children[1]; // 获取列表dom\n  }\n}\n</script>\n\n<style lang=\"less\">\n.allow{\n  overflow:hidden;\n  height: auto;\n}\n.prohibit{\n  max-width: 100%;\n  max-height: 100%;\n  height: 100%;\n  overflow:hidden;\n  overflow-y: scroll;\n  -webkit-overflow-scrolling: touch;\n  will-change: transform;\n  transition: all 450ms;\n  backface-visibility: hidden;\n  perspective: 1000;\n}\n.my-scroll{\n  position: relative;\n  color: #333333;\n  font-size: 14px;\n  .scroll-top{\n    text-align: center;\n    display:flex;\n    position:absolute;\n    top:0;\n    left:0;\n    width:100%;\n    overflow: hidden;\n    div{\n      display:flex;\n      height:auto;\n      width:100%;\n      justify-content: center;\n      align-items:center;\n      flex-wrap: wrap;\n      i{\n        flex:1 0 100%;\n        display:block;\n        height: 0.4rem;\n      }\n      img{\n        width:0.6rem;\n      }\n      p{\n        flex:1 0 100%;\n      }\n    }\n  }\n  .scroll-list{\n    overflow:hidden;\n    min-height: 100%;\n  }\n  .scroll-bottom{\n    text-align: center;\n    line-height: 40px;\n  }\n}\n</style>\n"]}]}